<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:behaviors="clr-namespace:WalletWasabi.Fluent.Behaviors"
             xmlns:i="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
             xmlns:buy="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy"
             xmlns:buyMessage="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy.Messages"
             xmlns:c="clr-namespace:WalletWasabi.Fluent.Controls"
             xmlns:shopinBit="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy.Workflows.ShopinBit"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="WalletWasabi.Fluent.Views.Wallets.Buy.OrderMessagesView"
             x:DataType="buy:BuyViewModel"
             x:CompileBindings="True">

  <UserControl.Resources>
    <SolidColorBrush x:Key="BlueishDarkGray" Color="#21252D" />
    <SolidColorBrush x:Key="AccentColor" Color="#6591EC" />
    <SolidColorBrush x:Key="Background" Color="#232932" />
    <SolidColorBrush x:Key="ErrorColor" Color="Red" />
  </UserControl.Resources>

  <Border Background="#343A47">

    <DockPanel x:Name="RightSide" Margin="8">

      <DockPanel DockPanel.Dock="Bottom">

        <Button DockPanel.Dock="Right"
                Command="{Binding SelectedOrder.SendCommand}"
                Margin="8 0 0 0"
                Content="{Binding SelectedOrder.WorkflowManager.CurrentWorkflow.CurrentStep.UserInputValidator.Content}"
                Classes="action"
                IsDefault="True">
          <i:Interaction.Behaviors>
            <behaviors:FocusOnAttachedBehavior />
          </i:Interaction.Behaviors>
        </Button>

        <ContentControl Content="{Binding SelectedOrder.WorkflowManager.CurrentWorkflow.CurrentStep.UserInputValidator}">
          <ContentControl.Styles>
            <Style Selector="TextBox">
              <Setter Property="MaxLength" Value="5000" />
            </Style>
          </ContentControl.Styles>
          <ContentControl.DataTemplates>

            <DataTemplate DataType="shopinBit:TextInputWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="{StaticResource Background}"
                       Text="{Binding Message}"
                       Watermark="{Binding Watermark}">
                <i:Interaction.Behaviors>
                  <behaviors:FocusOnAttachedBehavior />
                </i:Interaction.Behaviors>
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:DefaultWorkflowInputValidatorViewModel">
                <TextBox VerticalAlignment="Center"
                         Background="{StaticResource Background}"
                         Text="{Binding Message}"
                         Watermark="{Binding Watermark}">
                  <i:Interaction.Behaviors>
                    <behaviors:FocusOnAttachedBehavior />
                  </i:Interaction.Behaviors>
                  <TextBox.Styles>
                    <Style Selector="TextBox /template/ DataValidationErrors">
                      <Setter Property="IsVisible" Value="False" />
                    </Style>
                  </TextBox.Styles>
                </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:NoInputWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="{StaticResource Background}"
                       Text=""
                       Watermark=""
                       IsEnabled="False">
                <i:Interaction.Behaviors>
                  <behaviors:FocusOnAttachedBehavior />
                </i:Interaction.Behaviors>
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:ConfirmInitialWorkflowInputValidatorViewModel">
              <Panel />
            </DataTemplate>

            <DataTemplate DataType="shopinBit:ConfirmDeliveryWorkflowInputValidatorViewModel">
              <Panel />
            </DataTemplate>

            <DataTemplate DataType="shopinBit:PaymentWorkflowInputValidatorViewModel">
              <Panel />
            </DataTemplate>

            <DataTemplate DataType="shopinBit:PaymentWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="{StaticResource Background}"
                       Text=""
                       Watermark=""
                       IsEnabled="False">
                <i:Interaction.Behaviors>
                  <behaviors:FocusOnAttachedBehavior />
                </i:Interaction.Behaviors>
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:RequestWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="{StaticResource Background}"
                       Text="{Binding Message}"
                       Watermark="{Binding Watermark}">
                <i:Interaction.Behaviors>
                  <behaviors:FocusOnAttachedBehavior />
                </i:Interaction.Behaviors>
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:LocationWorkflowInputValidatorViewModel">
              <c:TagsBox VerticalAlignment="Center"
                         Background="{StaticResource Background}"
                         RestrictInputToSuggestions="True"
                         SuggestionsAreCaseSensitive="False"
                         Watermark="{Binding Watermark}"
                         MaxTextLength="5000"
                         ItemCountLimit="1"
                         Items="{Binding Country}"
                         Suggestions="{Binding Countries}">
                <i:Interaction.Behaviors>
                  <behaviors:FocusOnAttachedBehavior />
                </i:Interaction.Behaviors>
              </c:TagsBox>
            </DataTemplate>

          </ContentControl.DataTemplates>
        </ContentControl>

      </DockPanel>

      <ProgressBar IsIndeterminate="{Binding SelectedOrder.IsBusy}"
                   IsVisible="{Binding SelectedOrder.IsBusy}"
                   Margin="0,10,0,10"
                   Value="50"
                   DockPanel.Dock="Bottom"/>

      <ScrollViewer x:Name="MessagesScrollViewer"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
        <SelectingItemsControl x:Name="MessagesItemsControl"
                               Items="{Binding SelectedOrder.Messages}"
                               SelectedItem="{Binding SelectedOrder.SelectedMessage}">
          <SelectingItemsControl.Styles>
            <Style Selector="ContentPresenter > Border">
              <Setter Property="Padding" Value="14" />
              <Setter Property="Margin" Value="8" />
              <Setter Property="CornerRadius" Value="12" />
            </Style>
            <Style Selector="TextBlock">
              <Setter Property="TextWrapping" Value="Wrap" />
            </Style>
          </SelectingItemsControl.Styles>

          <SelectingItemsControl.DataTemplates>
            <DataTemplate DataType="buyMessage:UserMessageViewModel">
              <Border HorizontalAlignment="Right"
                       Background="{StaticResource AccentColor}">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
            <DataTemplate DataType="buyMessage:AssistantMessageViewModel">
              <Border HorizontalAlignment="Left"
                      Background="{StaticResource BlueishDarkGray}">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
            <DataTemplate DataType="buyMessage:ErrorMessageViewModel">
              <Border HorizontalAlignment="Left"
                      Background="{StaticResource ErrorColor}">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock VerticalAlignment="Center"
                             Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
          </SelectingItemsControl.DataTemplates>
        </SelectingItemsControl>
      </ScrollViewer>

    </DockPanel>

  </Border>

</UserControl>
