<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:buy="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy"
             xmlns:buyMessage="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy.Messages"
             xmlns:c="clr-namespace:WalletWasabi.Fluent.Controls"
             xmlns:workflows="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy.Workflows"
             xmlns:shopinBit="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.Buy.Workflows.ShopinBit"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="WalletWasabi.Fluent.Views.Wallets.Buy.OrderMessagesView"
             x:DataType="buy:BuyViewModel"
             x:CompileBindings="True">

  <Border Background="#343A47">

    <DockPanel x:Name="RightSide" Margin="8">

      <DockPanel DockPanel.Dock="Bottom">

        <Button DockPanel.Dock="Right"
                Command="{Binding SelectedOrder.SendCommand}"
                Margin="8 0 0 0"
                Content="Request"
                Classes="action" />

        <ContentControl Content="{Binding SelectedOrder.CurrentWorkflow.CurrentStep.UserInputValidator}">
          <ContentControl.DataTemplates>

            <DataTemplate DataType="shopinBit:DefaultWorkflowInputValidatorViewModel">
                <TextBox VerticalAlignment="Center"
                         Background="#232932"
                         Text="{Binding Message}"
                         Watermark="{Binding Watermark}"
                         MaxLength="5000">
                  <TextBox.Styles>
                    <Style Selector="TextBox /template/ DataValidationErrors">
                      <Setter Property="IsVisible" Value="False" />
                    </Style>
                  </TextBox.Styles>
                </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:NoInputWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="#232932"
                       Text=""
                       Watermark=""
                       MaxLength="5000"
                       IsEnabled="False">
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:RequestWorkflowInputValidatorViewModel">
              <TextBox VerticalAlignment="Center"
                       Background="#232932"
                       Text="{Binding Message}"
                       Watermark="{Binding Watermark}"
                       MaxLength="5000">
                <TextBox.Styles>
                  <Style Selector="TextBox /template/ DataValidationErrors">
                    <Setter Property="IsVisible" Value="False" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </DataTemplate>

            <DataTemplate DataType="shopinBit:LocationWorkflowInputValidatorViewModel">
              <!-- TODO: Text="{Binding Message}" -->
              <c:TagsBox VerticalAlignment="Center"
                         Background="#232932"
                         RestrictInputToSuggestions="True"
                         Watermark="{Binding Watermark}"
                         MaxTextLength="5000"
                         ItemCountLimit="1"
                         Items="{Binding Country}"
                         Suggestions="{Binding Countries}">
              </c:TagsBox>
            </DataTemplate>

          </ContentControl.DataTemplates>
        </ContentControl>

      </DockPanel>

      <ScrollViewer HorizontalScrollBarVisibility="Disabled">
        <!-- TODO: Add scrolling to last item when new message is added -->
        <ItemsControl Items="{Binding SelectedOrder.Messages}">
          <ItemsControl.DataTemplates>
            <DataTemplate DataType="buyMessage:UserMessageViewModel">
              <Border Padding="8"
                      Margin="8"
                      CornerRadius="12"
                      HorizontalAlignment="Right"
                      Background="#6591EC">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock TextWrapping="Wrap"
                             Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
            <DataTemplate DataType="buyMessage:AssistantMessageViewModel">
              <Border Padding="8"
                      Margin="8"
                      CornerRadius="12"
                      HorizontalAlignment="Left"
                      Background="#21252D">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock TextWrapping="Wrap"
                             Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
            <DataTemplate DataType="buyMessage:ErrorMessageViewModel">
              <Border Padding="8"
                      Margin="8"
                      CornerRadius="12"
                      HorizontalAlignment="Left"
                      Background="#FF0000">
                <c:PreviewItem CopyableContent="{Binding Message}">
                  <TextBlock TextWrapping="Wrap"
                             Text="{Binding Message}" />
                </c:PreviewItem>
              </Border>
            </DataTemplate>
          </ItemsControl.DataTemplates>
        </ItemsControl>
      </ScrollViewer>

    </DockPanel>

  </Border>

</UserControl>
